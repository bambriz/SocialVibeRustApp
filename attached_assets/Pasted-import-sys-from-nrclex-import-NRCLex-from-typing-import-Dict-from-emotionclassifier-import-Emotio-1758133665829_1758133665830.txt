import sys
from nrclex import NRCLex
from typing import Dict
from emotionclassifier import EmotionClassifier
def sarcasm_affection_analysis(text):
    """
    Initial sentiment analysis to detect sarcasm or affection
    Returns: "sarcasm", "affection", or "neutral"
    """
    text_lower = text.lower()
    emotions = NRCLex(text_lower)
    # sarcasm is detected by contradictory emotions such as joy and anger being near each otehr in value
    # out of emotions.top_emptions is a list of tuples with tuple index 0 being the emotion and index 1 being the value
    emotion_dict: Dict[str,float] = dict(emotions.top_emotions)
    if "joy" in emotion_dict and "anger" in emotion_dict:
        if abs(emotion_dict["joy"] - emotion_dict["anger"]) < 0.1:
            return "sarcasm"
    if "sadness" in emotion_dict and "joy" in emotion_dict:
        if abs(emotion_dict["sadness"] - emotion_dict["joy"]) < 0.1:
            return "sarcasm"
    if "disgust" in emotion_dict and "joy" in emotion_dict:
        if abs(emotion_dict["disgust"] - emotion_dict["joy"]) < 0.1:
            return "sarcasm"
    # affection is detected by presence of positive emotions like joy, trust, and anticipation
    if "joy" in emotion_dict and "trust" in emotion_dict:
        if emotion_dict["joy"] > 0.2 and emotion_dict["trust"] > 0.2 and "sadness" not in emotion_dict and "anger" not in emotion_dict and "fear" not in emotion_dict and "disgust" not in emotion_dict:
            return "affection" if abs(emotion_dict["joy"] - emotion_dict["trust"]) < 0.2 else "neutral"

    return "neutral"

def main_emotion_analysis(text):
    text = text.lower()
    classifier = EmotionClassifier()
    result = classifier.predict(text)
    return result['label']
def main():
    """Main function for command line usage"""
    if len(sys.argv) != 2:
        print("Usage: python custom_sentiment_analysis.py <text>")
        sys.exit(1)

    text = sys.argv[1]
    initial_sentiment_analysis = sarcasm_affection_analysis(text)
    if initial_sentiment_analysis in ["affection"]:
        print(initial_sentiment_analysis)
        return
    advance_sentiment_analysis = main_emotion_analysis(text)
    if initial_sentiment_analysis == "sarcasm":
        print(f"sarcasm+{advance_sentiment_analysis}")